# Full MS MARCO configuration (large downloads and long-running steps).
# This is not used by default. Use it explicitly:
#   CONFIG=configs/matryoshka.yaml make data train eval report

run_name: msmarco
seed: 123

paths:
  work_dir: .
  data_dir: data
  checkpoints_dir: checkpoints

data:
  dataset: msmarco
  msmarco:
    raw_dir: data/raw/msmarco
    processed_dir: data/processed/msmarco
    download:
      verify_checksums: true
      # Checksums are optional; when absent the downloader verifies size (if known) and warns.
      sha256: {}

model:
  hf_model_name: bert-base-uncased
  pooling: mean
  projection_dim: 768
  l2_normalize: true

train:
  device: auto
  batch_size: 64
  epochs: 1
  max_steps: null
  lr: 2.0e-5
  weight_decay: 0.01
  max_length_query: 32
  max_length_passage: 192
  fp16: true
  deterministic: false
  deterministic_warn_only: true
  log_every: 50
  save_every: 500

experiments:
  dense_baseline:
    use_matryoshka: false
    matryoshka_dims: [768]
    temperature: 0.05
  matryoshka:
    use_matryoshka: true
    matryoshka_dims: [768, 384, 192, 96]
    temperature: 0.05

eval:
  dims: [768, 384, 192, 96]
  topk: [10, 50, 100, 1000]
  max_queries: 1000
  use_faiss_if_available: true
  bm25:
    enabled: true

